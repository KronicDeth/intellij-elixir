name: Publish to Canary
on:
#  release:
#    types: [prereleased]
  workflow_dispatch:

jobs:
  publish-to-canary:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository ðŸ’¾
        uses: actions/checkout@v5

      - name: Setup Build Environment â˜•
        uses: ./.github/actions/setup-env
        with:
          elixir-version: ''

      - name: Download release asset ðŸ“¦
        id: download_asset
        uses: dsaltares/fetch-gh-release-asset@1.1.2
        with:
          repo: ${{ github.repository }}
          version: tags/${{ github.ref_name }}
          file: intellij-elixir-${{ github.ref_name }}.zip
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Publish to Canary ðŸ£
        env:
          JET_BRAINS_MARKETPLACE_TOKEN: ${{ secrets.JetBrainsMarketplaceToken }}
        run: >
          ./gradlew publishPlugin -PdistributionFile=intellij-elixir-${{ github.ref_name }}.zip